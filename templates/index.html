<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OneWord - í•œ ë‹¨ì–´ë¡œ ìŠ¤ë§ˆíŠ¸ ê²€ìƒ‰</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>OneWord</h1>
        <form method="POST">
            <div class="categories">
                {% for cat in categories %}
                    <input type="radio" id="cat{{loop.index}}" name="category" value="{{cat}}" {% if cat == selected_category %}checked{% endif %} style="display:none;">
                    <label for="cat{{loop.index}}">{{cat}}</label>
                {% endfor %}
            </div>
            <div class="search-box" id="search-box">
                {% if selected_category == 'êµí†µ' %}
                    <input type="text" name="departure" placeholder="ì¶œë°œì§€ (ì˜ˆ: ê°•ë‚¨ì—­)" value="{{departure}}" id="departure-input">
                    <input type="text" name="destination" placeholder="ë„ì°©ì§€ (ì˜ˆ: í™ëŒ€ì…êµ¬ì—­)" value="{{destination}}" id="destination-input">
                {% else %}
                    <input type="text" name="keyword" placeholder="ë‹¨ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”" value="{{keyword}}" id="keyword-input">
                {% endif %}
                <button type="submit" id="search-btn">
                    <span class="btn-text">ğŸ” ê²€ìƒ‰</span>
                    <span class="btn-loading" style="display: none;">
                        <svg class="spinner" width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-dasharray="32" stroke-dashoffset="32">
                                <animate attributeName="stroke-dasharray" dur="2s" values="0 32;16 16;0 32;0 32" repeatCount="indefinite"/>
                                <animate attributeName="stroke-dashoffset" dur="2s" values="0;-16;-32;-32" repeatCount="indefinite"/>
                            </circle>
                        </svg>
                        ê²€ìƒ‰ì¤‘...
                    </span>
                </button>
            </div>
        </form>
        {% if result %}
            <div class="result">
                {% if selected_category == 'ë ˆì‹œí”¼' and parsed_recipe %}
                    {# ë ˆì‹œí”¼: íŒŒì‹±ëœ ì¬ë£Œì™€ ì¡°ë¦¬ë²• í‘œì‹œ #}
                    <div style="text-align:left;">
                        <div>{{ parsed_recipe.ingredients|replace('\n', '<br>')|safe }}</div>
                        {% if parsed_recipe.steps %}
                            <div style="margin-top:10px;"><b>ì¡°ë¦¬ë²•</b></div>
                            <ul style="margin:0 0 0 18px; padding:0;">
                            {% for step in parsed_recipe.steps %}
                                <li>{{ step }}</li>
                            {% endfor %}
                            </ul>
                        {% endif %}
                    </div>
                {% elif selected_category == 'ë‚ ì”¨' %}
                    {# ë‚ ì”¨: / ë˜ëŠ” \n ê¸°ì¤€ìœ¼ë¡œ ì‹œê°„ëŒ€ë³„ ì¤„ë°”ê¿ˆ #}
                    <div style="text-align:left;">
                        {% for line in result.replace('/', '\n').split('\n') %}
                            <div>{{ line.strip() }}</div>
                        {% endfor %}
                    </div>
                {% else %}
                    {{ result|replace('\n', '<br>')|safe }}
                {% endif %}
            </div>
        {% endif %}
    </div>

    <script>
        function updateSearchBox() {
            const selectedCategory = document.querySelector('input[name="category"]:checked').value;
            const searchBox = document.getElementById('search-box');
            
            if (selectedCategory === 'êµí†µ') {
                searchBox.innerHTML = `
                    <input type="text" name="departure" placeholder="ì¶œë°œì§€ (ì˜ˆ: ê°•ë‚¨ì—­)" id="departure-input">
                    <input type="text" name="destination" placeholder="ë„ì°©ì§€ (ì˜ˆ: í™ëŒ€ì…êµ¬ì—­)" id="destination-input">
                    <button type="submit" id="search-btn">
                        <span class="btn-text">ğŸ” ê²€ìƒ‰</span>
                        <span class="btn-loading" style="display: none;">
                            <svg class="spinner" width="16" height="16" viewBox="0 0 24 24" fill="none">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-dasharray="32" stroke-dashoffset="32">
                                    <animate attributeName="stroke-dasharray" dur="2s" values="0 32;16 16;0 32;0 32" repeatCount="indefinite"/>
                                    <animate attributeName="stroke-dashoffset" dur="2s" values="0;-16;-32;-32" repeatCount="indefinite"/>
                                </circle>
                            </svg>
                            ê²€ìƒ‰ì¤‘...
                        </span>
                    </button>
                `;
            } else {
                const placeholders = {
                    'ë‚ ì”¨': 'ì§€ì—­ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì„œìš¸)',
                    'ë ˆì‹œí”¼': 'ìš”ë¦¬ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ê¹€ì¹˜ì°Œê°œ)',
                    'ì£¼ê°€': 'ì£¼ì‹ëª…ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì‚¼ì„±ì „ì)',
                    'ëª…ì–¸': 'ì£¼ì œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì¸ìƒ)'
                };
                searchBox.innerHTML = `
                    <input type="text" name="keyword" placeholder="${placeholders[selectedCategory] || 'ë‹¨ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”'}" id="keyword-input">
                    <button type="submit" id="search-btn">
                        <span class="btn-text">ğŸ” ê²€ìƒ‰</span>
                        <span class="btn-loading" style="display: none;">
                            <svg class="spinner" width="16" height="16" viewBox="0 0 24 24" fill="none">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-dasharray="32" stroke-dashoffset="32">
                                    <animate attributeName="stroke-dasharray" dur="2s" values="0 32;16 16;0 32;0 32" repeatCount="indefinite"/>
                                    <animate attributeName="stroke-dashoffset" dur="2s" values="0;-16;-32;-32" repeatCount="indefinite"/>
                                </circle>
                            </svg>
                            ê²€ìƒ‰ì¤‘...
                        </span>
                    </button>
                `;
            }
        }

        // ì¹´í…Œê³ ë¦¬ ë³€ê²½ ì‹œ ì…ë ¥ í•„ë“œ ì—…ë°ì´íŠ¸ ë° ê²°ê³¼ ì´ˆê¸°í™”
        document.querySelectorAll('input[name="category"]').forEach(radio => {
            radio.addEventListener('change', function() {
                updateSearchBox();
                
                // ê¸°ì¡´ ê²°ê³¼ ì´ˆê¸°í™”
                const resultDiv = document.querySelector('.result');
                if (resultDiv) {
                    resultDiv.style.animation = 'fadeOut 0.3s ease-out forwards';
                    setTimeout(() => {
                        resultDiv.remove();
                    }, 300);
                }
            });
        });

        // í¼ ì œì¶œ ì‹œ ë¡œë”© ìƒíƒœ í‘œì‹œ
        document.querySelector('form').addEventListener('submit', function(e) {
            const searchBtn = document.getElementById('search-btn');
            const btnText = searchBtn.querySelector('.btn-text');
            const btnLoading = searchBtn.querySelector('.btn-loading');
            
            if (btnText && btnLoading) {
                btnText.style.display = 'none';
                btnLoading.style.display = 'flex';
                btnLoading.style.alignItems = 'center';
                btnLoading.style.gap = '8px';
                searchBtn.disabled = true;
            }
        });
    </script>
</body>
</html>