<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OneWord - 한 단어로 스마트 검색</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>OneWord</h1>
        <form method="POST">
            <div class="categories">
                {% for cat in categories %}
                    <input type="radio" id="cat{{loop.index}}" name="category" value="{{cat}}" {% if cat == selected_category %}checked{% endif %} style="display:none;">
                    <label for="cat{{loop.index}}">{{cat}}</label>
                {% endfor %}
            </div>
            <div class="search-box" id="search-box">
                {% if selected_category == '교통' %}
                    <input type="text" name="departure" placeholder="출발지 (예: 강남역)" value="{{departure}}" id="departure-input">
                    <input type="text" name="destination" placeholder="도착지 (예: 홍대입구역)" value="{{destination}}" id="destination-input">
                {% else %}
                    <input type="text" name="keyword" placeholder="단어를 입력하세요" value="{{keyword}}" id="keyword-input">
                {% endif %}
                <button type="submit" id="search-btn">
                    <span class="btn-text">🔍 검색</span>
                    <span class="btn-loading" style="display: none;">
                        <svg class="spinner" width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-dasharray="32" stroke-dashoffset="32">
                                <animate attributeName="stroke-dasharray" dur="2s" values="0 32;16 16;0 32;0 32" repeatCount="indefinite"/>
                                <animate attributeName="stroke-dashoffset" dur="2s" values="0;-16;-32;-32" repeatCount="indefinite"/>
                            </circle>
                        </svg>
                        검색중...
                    </span>
                </button>
            </div>
        </form>
        {% if result %}
            <div class="result">
                {% if selected_category == '레시피' and parsed_recipe %}
                    {# 레시피: 파싱된 재료와 조리법 표시 #}
                    <div style="text-align:left;">
                        <div>{{ parsed_recipe.ingredients|replace('\n', '<br>')|safe }}</div>
                        {% if parsed_recipe.steps %}
                            <div style="margin-top:10px;"><b>조리법</b></div>
                            <ul style="margin:0 0 0 18px; padding:0;">
                            {% for step in parsed_recipe.steps %}
                                <li>{{ step }}</li>
                            {% endfor %}
                            </ul>
                        {% endif %}
                    </div>
                {% elif selected_category == '날씨' %}
                    {# 날씨: 구조화된 카드 레이아웃 #}
                    <div class="weather-container">
                        {% set weather_lines = result.split('\n') %}
                        {% set current_section = '' %}
                        {% set in_current_weather = false %}
                        {% set in_forecast = false %}
                        {% set in_tips = false %}
                        
                        {% for line in weather_lines %}
                            {% set clean_line = line.strip() %}
                            {% if clean_line %}
                                {% if '날씨 정보' in clean_line %}
                                    <div class="weather-header">
                                        <h3>{{ clean_line }}</h3>
                                    </div>
                                {% elif '📍' in clean_line and '특별시' in clean_line or '광역시' in clean_line or '도' in clean_line %}
                                    <div class="weather-location">{{ clean_line }}</div>
                                {% elif '🕐 현재 날씨' in clean_line %}
                                    {% set in_current_weather = true %}
                                    <div class="weather-current">
                                        <div class="weather-section-title">{{ clean_line }}</div>
                                {% elif '┌─────────────────────┐' in clean_line %}
                                    <div class="weather-card">
                                {% elif '│' in clean_line and in_current_weather %}
                                    {% if '☀️' in clean_line or '🌧️' in clean_line or '☁️' in clean_line or '⛅' in clean_line or '❄️' in clean_line or '⛈️' in clean_line or '🌨️' in clean_line or '🌤️' in clean_line %}
                                        <div class="weather-status">{{ clean_line.replace('│', '').strip() }}</div>
                                    {% elif '🌡️' in clean_line %}
                                        <div class="weather-temp">{{ clean_line.replace('│', '').strip() }}</div>
                                    {% elif '💧' in clean_line %}
                                        <div class="weather-humidity">{{ clean_line.replace('│', '').strip() }}</div>
                                    {% elif '💨' in clean_line %}
                                        <div class="weather-wind">{{ clean_line.replace('│', '').strip() }}</div>
                                    {% elif '🌧️' in clean_line and 'mm' in clean_line %}
                                        <div class="weather-rain">{{ clean_line.replace('│', '').strip() }}</div>
                                    {% endif %}
                                {% elif '└─────────────────────┘' in clean_line %}
                                    </div>
                                    {% set in_current_weather = false %}
                                    </div>
                                {% elif '📅 오늘의 예보' in clean_line %}
                                    {% set in_forecast = true %}
                                    <div class="weather-forecast">
                                        <div class="weather-section-title">{{ clean_line }}</div>
                                        <div class="forecast-grid">
                                {% elif in_forecast and ('🌅' in clean_line or '☀️' in clean_line or '🌙' in clean_line) %}
                                    {% set parts = clean_line.split('│') %}
                                    <div class="forecast-item">
                                        {% for part in parts %}
                                            {% set clean_part = part.strip() %}
                                            {% if clean_part %}
                                                {% if '🌅' in clean_part or '☀️' in clean_part or '🌙' in clean_part %}
                                                    <div class="forecast-time">{{ clean_part }}</div>
                                                {% elif '☀️' in clean_part or '🌧️' in clean_part or '☁️' in clean_part or '⛅' in clean_part or '❄️' in clean_part or '⛈️' in clean_part or '🌨️' in clean_part or '🌤️' in clean_part %}
                                                    <div class="forecast-weather">{{ clean_part }}</div>
                                                {% elif '🌡️' in clean_part %}
                                                    <div class="forecast-temp">{{ clean_part }}</div>
                                                {% endif %}
                                            {% endif %}
                                        {% endfor %}
                                    </div>
                                {% elif '💡 날씨 팁' in clean_line %}
                                    {% if in_forecast %}
                                        </div>
                                        </div>
                                        {% set in_forecast = false %}
                                    {% endif %}
                                    {% set in_tips = true %}
                                    <div class="weather-tips">
                                        <div class="weather-section-title">{{ clean_line }}</div>
                                {% elif in_tips and ('☂️' in clean_line or '😎' in clean_line or '☁️' in clean_line or '💨' in clean_line) %}
                                    <div class="tip-item">{{ clean_line.strip() }}</div>
                                {% elif '📊 한국기상청' in clean_line %}
                                    {% if in_tips %}
                                        </div>
                                        {% set in_tips = false %}
                                    {% endif %}
                                    {% if in_forecast %}
                                        </div>
                                        </div>
                                        {% set in_forecast = false %}
                                    {% endif %}
                                    <div class="weather-footer">{{ clean_line }}</div>
                                {% elif clean_line != '─────────────────────────' and clean_line != '=========================' %}
                                    {% if not in_current_weather and not in_forecast and not in_tips %}
                                        <div class="weather-info">{{ clean_line }}</div>
                                    {% endif %}
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                        
                        {% if in_tips %}
                            </div>
                        {% endif %}
                        {% if in_forecast %}
                            </div>
                            </div>
                        {% endif %}
                    </div>
                {% else %}
                    {{ result|replace('\n', '<br>')|safe }}
                {% endif %}
            </div>
        {% endif %}
    </div>

    <script>
        function updateSearchBox() {
            const selectedCategory = document.querySelector('input[name="category"]:checked').value;
            const searchBox = document.getElementById('search-box');
            
            if (selectedCategory === '교통') {
                searchBox.innerHTML = `
                    <input type="text" name="departure" placeholder="출발지 (예: 강남역)" id="departure-input">
                    <input type="text" name="destination" placeholder="도착지 (예: 홍대입구역)" id="destination-input">
                    <button type="submit" id="search-btn">
                        <span class="btn-text">🔍 검색</span>
                        <span class="btn-loading" style="display: none;">
                            <svg class="spinner" width="16" height="16" viewBox="0 0 24 24" fill="none">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-dasharray="32" stroke-dashoffset="32">
                                    <animate attributeName="stroke-dasharray" dur="2s" values="0 32;16 16;0 32;0 32" repeatCount="indefinite"/>
                                    <animate attributeName="stroke-dashoffset" dur="2s" values="0;-16;-32;-32" repeatCount="indefinite"/>
                                </circle>
                            </svg>
                            검색중...
                        </span>
                    </button>
                `;
            } else {
                const placeholders = {
                    '날씨': '지역을 입력하세요 (예: 서울)',
                    '레시피': '요리를 입력하세요 (예: 김치찌개)',
                    '주가': '주식명을 입력하세요 (예: 삼성전자)',
                    '명언': '주제를 입력하세요 (예: 인생)'
                };
                searchBox.innerHTML = `
                    <input type="text" name="keyword" placeholder="${placeholders[selectedCategory] || '단어를 입력하세요'}" id="keyword-input">
                    <button type="submit" id="search-btn">
                        <span class="btn-text">🔍 검색</span>
                        <span class="btn-loading" style="display: none;">
                            <svg class="spinner" width="16" height="16" viewBox="0 0 24 24" fill="none">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-dasharray="32" stroke-dashoffset="32">
                                    <animate attributeName="stroke-dasharray" dur="2s" values="0 32;16 16;0 32;0 32" repeatCount="indefinite"/>
                                    <animate attributeName="stroke-dashoffset" dur="2s" values="0;-16;-32;-32" repeatCount="indefinite"/>
                                </circle>
                            </svg>
                            검색중...
                        </span>
                    </button>
                `;
            }
        }

        // 카테고리 변경 시 입력 필드 업데이트 및 결과 초기화
        document.querySelectorAll('input[name="category"]').forEach(radio => {
            radio.addEventListener('change', function() {
                updateSearchBox();
                
                // 기존 결과 초기화
                const resultDiv = document.querySelector('.result');
                if (resultDiv) {
                    resultDiv.style.animation = 'fadeOut 0.3s ease-out forwards';
                    setTimeout(() => {
                        resultDiv.remove();
                    }, 300);
                }
            });
        });

        // 폼 제출 시 로딩 상태 표시
        document.querySelector('form').addEventListener('submit', function(e) {
            const searchBtn = document.getElementById('search-btn');
            const btnText = searchBtn.querySelector('.btn-text');
            const btnLoading = searchBtn.querySelector('.btn-loading');
            
            if (btnText && btnLoading) {
                btnText.style.display = 'none';
                btnLoading.style.display = 'flex';
                btnLoading.style.alignItems = 'center';
                btnLoading.style.gap = '8px';
                searchBtn.disabled = true;
            }
        });
    </script>
</body>
</html>